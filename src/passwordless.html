<h1>Passwordless</h1>

<button onclick="getToken()">Authorise</button>

<script>
  function getToken() {
    console.log("getToken");
    window.parent.postMessage("foo", window.location.origin);
  }

  function removeListenForPhoneNumber() {
    console.log("removeListenForPhoneNumber");
    window.removeEventListener("message", handlePhoneNumber, false);
  }

  function handlePhoneNumber(event) {
    console.log("handlePhoneNumber");
    removeListenForPhoneNumber();
    console.log(`Phone number: ${event.data.data}`);
  }

  function listenForPhoneNumber() {
    console.log("listenForPhoneNumber");
    window.addEventListener("message", handlePhoneNumber, false);
  }

  function loadedMessage() {
    console.log("loadedMessage");
    window.parent.postMessage("loaded", window.location.origin);
    listenForPhoneNumber();
  }

  window.onload = () => {
    console.log("onload");
    loadedMessage();
  }
</script>
